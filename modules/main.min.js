var MAIN="https://api-paintball.herokuapp.com",CLIENTS=MAIN+"/clients/2017-10-28",LOCATIONSGET=MAIN+"/locations/{locationid}",LOCATIONPUT=MAIN+"/locations/products/{location_code}/{product_id}",PRODUCTS=MAIN+"/products",PRODUCTSPUT=MAIN+"/products/{product_id}",PRODUCTSDELETE=MAIN+"/products/{product_id}",ICONS=MAIN+"/icons",ICONSLIST=getIcons().responseJSON,DELETELOCAION=MAIN+"/location/{location_code}",MAINFRONT="http://127.0.0.1:8080";
function printProducts(){var a=getProducts().responseJSON.products,b=0,e=0;for(i=0;i<a.length;i++){var c=a[i].id,d=a[i].name,h=a[i].icon_ref,f=a[i].price,g=a[i].products_in_list,k=a[i].products_in_payment,l='<a class="white-text imgicon col m12 l4" onclick="clickOnProduct(\''+d+"','"+f+"','"+c+"','"+i+'\')" aria-label="'+d+'">          <i  class="fa '+h+' fa-4x fa-border hoverable" aria-hidden="true" title="'+d+'"></i></i>        </a>',m='<a class="white-text imgicon col m12 l4" onclick="clickInList(\''+
d+"','"+f+"','"+c+"','"+i+'\')" aria-label="'+d+'">          <i id ="list'+c+'" class="fa '+h+' fa-3x fa-border hoverable" aria-hidden="true" title="'+d+'">'+g+"</i>        </a>",c='<a class="white-text imgicon col m12 l4" onclick="clickInPay(\''+d+"','"+f+"','"+c+"','"+i+'\')" aria-label="'+d+'">          <i id ="pay'+c+'" class="fa '+h+' fa-3x fa-border hoverable" aria-hidden="true" title="'+d+'">'+k+"</i>        </a>";$("#products").append(l);$("#list").append(m);$("#topay").append(c);b+=g*f;e+=
k*f}$("#totalList").html(b);$("#totalPay").html(e)}function getPay(a){return getProducts().responseJSON.products[a].products_in_payment}function getList(a){return getProducts().responseJSON.products[a].products_in_list}
function actualize(){var a=getProducts().responseJSON.products,b=0,e=0;data[i]={};data[i].client_name=element.client.name+" "+element.client.last_name;data[i].client_email=element.client.email;data[i].type=element.location.type.name;data[i].phone=element.client.phone;data[i].hour_start=element.location.hour_start;data[i].hour_end=element.location.hour_end;data[i].players=element.location.players;data[i].code=element.location.code;data[i].terrain=element.location.terrain.name;a.forEach(function(a){var c=
a.products_in_list,h=a.products_in_payment,f=a.price;a=a.id;$("#list"+a).html(c);$("#pay"+a).html(h);b+=c*f;e+=h*f});$("#totalList").html(b);$("#totalPay").html(e)}var pay_total=getPay(key);function getProducts(){var a=location.search.split("code_loc=")[1],a=LOCATIONSGET.replace("{locationid}",a);return $.ajax({url:a,type:"GET",dataType:"json",async:!1,success:function(a){return a.products}})}
function generateLocation(a){0==a.length?$("#locations").append('<div class="col s12 m12 l4">                     </div>                    <div class="col s12 m12 l4">                       <div class="card light-blue darken-2">                        <div class="card-content black-text">                          <div class="row">                            <ul class="collection with-header">                               <li class="collection-header center"><h4>Pas de location pour <br> Ajourd\'hui</h4></li>                            </ul>                          </div>                      </div>                    </div>                  </div>'):a.forEach(function(a){a=
'<div class="col s12 m6 l6">                    <div onclick="writeLocation(\''+a.code+'\')" class="hoverable">                       <div class="card grey darken-4">                       <div class="card-content  black-text">                         <div class="row">                           <ul class="collection with-header">                             <li class="collection-header center"><h5>'+a.client_name+'</h5></li>                             <a class="collection-item grey-text darken-2"><span class="badge black-text">'+
a.type+'</span>Type: </a>                             <a class="collection-item grey-text darken-2"><span class="badge black-text">'+a.phone+'</span>tel: </a>                             <a class="collection-item grey-text darken-2"><span class="badge black-text">'+a.client_email+'</span>mail: </a>                             <a class="collection-item grey-text darken-2"><span class="badge black-text">'+a.hour_start+'</span>Heure start: </a>                             <a class="collection-item grey-text darken-2"><span class="badge black-text">'+
a.hour_end+'</span>Heure end: </a>                             <a class="collection-item grey-text darken-2"><span class="badge black-text">'+a.terrain+'</span>Terrain: </a>                             <a class="collection-item grey-text darken-2"><span class="badge black-text">'+a.players+"</span>Nombre: </a>                           </ul>                         </div>                       </div>                     </div>                   </div>                 </div>";$("#locations").append(a)})}
function countingAll(){productForSell.forEach(function(a){$("#list"+a.name+"").append(a.products_in_list);$("#pay"+a.name+"").append(a.products_in_payment)})}function getLocation(){jQuery.support.cors=!0;$.ajax({url:CLIENTS,type:"GET",dataType:"json",success:function(a){generateLocation(parseResult(a))}})}
function parseResult(a){var b=[];a.forEach(function(a,c){null!=a.location&&(b[c]={},b[c].client_name=a.client.name+" "+a.client.last_name,b[c].client_email=a.client.email,b[c].type=a.location.type.name,b[c].phone=a.client.phone,b[c].hour_start=a.location.hour_start,b[c].hour_end=a.location.hour_end,b[c].players=a.location.players,b[c].code=a.location.code,b[c].terrain=a.location.terrain.name)});return b}
function clickOnProduct(a,b,e,c){swal("Ajouter -> "+a,{content:"input"}).then(function(b){0==b?swal({title:" Il faut \u00e9crire un numero",icon:"warning"}):(addNumberList(e,parseInt(b)),actualize(),Materialize.toast(+b+"  "+a+"   -> List",3E3))})}
function clickInList(a,b,e,c){var d=getList(c);swal({title:"Selectioner votre option",buttons:{Suprimer:{value:"Suprimer"},Tout:{value:"tout"},Un:{value:"un"},"=>":{value:"choisir"}}}).then(function(b){switch(b){case "Suprimer":swal("Combien?",{content:"input"}).then(function(b){0<d&&d>=parseInt(b)?(removeNumberList(e,parseInt(b)),actualize(),Materialize.toast(parseInt(b)+"  "+a+"   Deleted",3E3)):swal({title:" Il n'y a pas assez ---\x3e "+a,icon:"warning"})});break;case "tout":0<d?(editproduct(e,
0,d,d,0),actualize(),Materialize.toast(d+"  "+a+"   -> Payment",3E3)):swal({title:" Il n'y plus de "+products[c].name,icon:"warning"});break;case "un":0<d?(editproduct(e,0,1,1,0),actualize(),Materialize.toast("1  "+products[c].name+"   -> Payment",3E3)):swal({title:" Il n'y plus de "+products[c].name,icon:"warning"});break;case "choisir":swal("Combien?:",{content:"input"}).then(function(b){0<d&&d>=parseInt(b)?(editproduct(e,0,parseInt(b),parseInt(b),0),Materialize.toast(+b+"  "+a+"   -> Payment",
3E3),actualize()):"0"==b|0==b?swal({title:" Il faut \u00e9crire un numero",icon:"warning"}):swal({title:" Il n'y a pas assez ---\x3e "+a,icon:"warning"})});break;default:swal("Operation cancel\u00e9!",{className:"red",buttons:!1,timer:600})}})}
function clickInPay(a,b,e,c){var d=getPay(c);swal({title:"Selectioner votre option",buttons:{Suprimer:{value:"Suprimer"},Tout:{value:"tout"},Un:{value:"un"},"<=":{value:"choisir"}}}).then(function(b){switch(b){case "Suprimer":swal("Combien?",{content:"input"}).then(function(b){0<d&&d>=parseInt(b)?(removeNumberPay(e,parseInt(b)),actualize(),Materialize.toast(parseInt(b)+"  "+a+"   Deleted",3E3)):swal({title:" Il n'y a pas assez ---\x3e "+a,icon:"warning"})});break;case "tout":editproduct(e,d,0,0,d);
actualize();Materialize.toast(+d+"  "+a+" <-- List",3E3);break;case "un":0<d?(editproduct(e,1,0,0,1),actualize(),Materialize.toast("1  "+a+"   <- List",3E3)):swal({title:" Il n'y plus de "+a,icon:"warning"});break;case "choisir":swal("Combien?:",{content:"input"}).then(function(b){0<d&&d>=parseInt(b)?(editproduct(e,parseInt(b),0,0,parseInt(b)),actualize(),Materialize.toast(+b+"  "+a+"   <- List",3E3)):0==b?swal({title:" Il faut \u00e9crire un numero",icon:"warning"}):swal({title:" Il n'y a pas assez ---\x3e "+
a,icon:"warning"})});break;default:swal("Operation cancel\u00e9!",{className:"red",buttons:!1,timer:600})}})}function writeLocation(a){window.open("terrain?code_loc="+a,"_self")}function clickLocation(){var a=location.search.split("code_loc=")[1],a=LOCATIONSGET.replace("{locationid}",a);$.ajax({url:a,type:"GET",dataType:"json",success:function(a){productForSell=a.products;printClient(a)}})}
function printClient(a){var b='<a href="#modal2" class="modal-trigger brand-logo center">'+a.client.name+"</a>";a="<table>                  <tr>                    <td><b>Email:</b></td>                   <td>"+a.client.email+"</td>                 </tr>                  <tr>                    <td><b>Phone:</b></td>                   <td>"+a.client.phone+"</td>                 </tr>                  <tr>                    <td><b>Terrain:</b></td>                   <td>"+a.location.terrain_id+"</td>                 </tr>                  <tr>                    <td><b>Hour Start:</b></td>                   <td>"+
a.location.hour_start+"</td>                 </tr>                  <tr>                    <td><b>Hour End:</b></td>                   <td>"+a.location.hour_end+"</td>                 </tr>                  <tr>                    <td><b>Initial Players:</b></td>                   <td>"+a.location.players+"</td>                 </tr>";$("#name_lastName").append(b);$("#modal2_content").append(a)}
function modifyProduct(a){var b={icon_id:$("#input_icon_"+a+"").val(),name:$("#input_name_"+a+"").val(),price:$("#input_price_"+a+"").val()};modifyProductAjax(a,b);location.reload()}function createProduct(){var a={icon_id:$("#input_icon_create_product").val(),name:$("#input_name_create_product").val(),price:$("#input_price_create_product").val()};createProductAjax(a);location.reload()}
function deleteProduct(a){swal({title:"Are you sure?",text:"Once deleted, you will not be able to recover this product!",icon:"warning",buttons:!0,dangerMode:!0}).then(function(b){if(b)return b=PRODUCTSDELETE,b=b.replace("{product_id}",a),$.ajax({url:b,type:"DELETE",contentType:"application/json",data:JSON.stringify({ok:!0}),async:!1,success:function(a){location.reload();return a}});swal("Your product is safe!")})}
function addNumberList(a,b){productsAjax(a,{add:{products_in_list:b,products_in_payment:0}})}function removeNumberList(a,b){productsAjax(a,{remove:{products_in_list:b,products_in_payment:0}})}function addNumberPay(a,b){productsAjax(a,{add:{products_in_list:0,products_in_payment:b}})}function removeNumberPay(a,b){productsAjax(a,{remove:{products_in_list:0,products_in_payment:b}})}
function editproduct(a,b,e,c,d){productsAjax(a,{add:{products_in_list:b,products_in_payment:c},remove:{products_in_list:e,products_in_payment:d}})}function productsAjax(a,b){var e=location.search.split("code_loc=")[1],c=LOCATIONPUT,c=c.replace("{location_code}",e),c=c.replace("{product_id}",a);return $.ajax({url:c,type:"PUT",contentType:"application/json",data:JSON.stringify(b),async:!1,success:function(a){return a}})}
function modifyProductAjax(a,b){var e=PRODUCTSPUT,e=e.replace("{product_id}",a);return $.ajax({url:e,type:"PUT",contentType:"application/json",data:JSON.stringify(b),async:!1,success:function(a){return a}})}function createProductAjax(a){return $.ajax({url:PRODUCTS,type:"POST",contentType:"application/json",data:JSON.stringify(a),async:!1,success:function(a){return a}})}
function getListProducts(){return $.ajax({url:PRODUCTS,type:"GET",contentType:"application/json",async:!1,success:function(a){return a}})}function getIcons(){return $.ajax({url:ICONS,type:"GET",contentType:"application/json",async:!1,success:function(a){return a}})}function printIconsList(){var a='<datalist id="icons">';ICONSLIST.forEach(function(b){a=a+'<option value="'+b.id+'">'+b.name+"</option>"});a+="</datalist>";$("body").append(a)}
function printListProducts(){var a=getListProducts().responseJSON.products;a.forEach(function(a){var b=a.name,c=a.id;a='<div id="modal_'+b+'" class="modal modal-fixed-footer">      <div class="modal-content">        <h4>'+b+'</h4>        <div class="row">          <form class="col s12">            <div class="row">              <div class="input-field col s6">                <input value="'+b+'" id="input_name_'+c+'" type="text" class="validate">                <label for="first_name">Name</label>              </div>              </div>              <div class="input-field col s6">                <input value="'+
a.price+'" id="input_price_'+c+'" type="text" class="validate">                <label for="first_name">Price in Fr</label>              </div>              <div class="input-field col s6">                <select value="'+a.icon_ref+'" class="icons-select" id="input_icon_'+c+'"></select>            </div>          </form>        </div>      </div>      <div class="modal-footer">        <a href="#!" class="modal-action modal-close waves-effect waves-green btn-flat orange-text">Cancel</a>        <a href="#!" onclick="deleteProduct('+
c+'); location.reload();" class="modal-action modal-close waves-effect waves-green btn-flat red-text">Suprimer</a>       <a href="#!" onclick="modifyProduct('+c+')" class="modal-action modal-close waves-effect waves-green btn-flat green-text">Modifier</a>      </div>    </div>';$("body").append(a)});var b=getIcons(),e=1;a.forEach(function(a){var b=a.name,c=a.price,f=a.icon_ref;a=a.id;var g="";0==e%3&&(g='<div class="row">');g=g+'<div class="card col s3 offset-s1 hoverable container">       <div class="card-image waves-effect waves-block waves-light center-align">         <i class="activator fa '+
f+' fa-10x"></i>       </div>       <div class="card-content">       <div class="card-action">         <span class="card-title activator grey-text text-darken-4"><p class="center"><b>'+b+'</b></p></span>         <span class="card-title activator grey-text text-darken-4">Price :  <p class="right">'+c+'</p></span>       </div>       </div>       <div class="card-action">       <a class="red-text" href="#" onclick="deleteProduct('+a+');" >Delete</a>          <a class="blue-text modal-trigger right" href="#modal_'+
b+'">Edit</a>        <div class="card-reveal">         <span class="card-title grey-text text-darken-4">'+b+'<i class="fa fa-times-circle-o right"></i></span>         <p>           Icon Name: '+f+"<br><br> Description: Lorem ipsum dolor sit amet, consectetur adipisicing elit, sed do eiusmod tempor incididunt ut labore et dolore magna aliqua. Ut enim ad.<br>         </p>       </div>     </div> ";$("#products_list").append(g);e++});this.init_select2(b)}
function init_select2(a){a.then(function(a){result=[];for(i=0;i<a.length;i++)name='<div><i class="right fa fa-2x '+a[i].ref+'"></i> '+a[i].name+"</div>",result[i]={id:a[i].id,text:name};$(".icons-select").select2({cache:!0,data:result,templateResult:function(a){return $(a.text)},templateSelection:function(a){return $(a.text)}})});actualize_icons_select2();return!0}
function actualize_icons_select2(){return setTimeout(function(){getListProducts().responseJSON.products.forEach(function(a){var b=a.icon_id;a=a.id;$("#input_icon_"+a).val(b);$("#input_icon_"+a).trigger("change")})},2E3)}
function close_Cash_register(){var a=location.search.split("code_loc=")[1],a=DELETELOCAION.replace("{location_code}",a);$.ajax({url:a,type:"DELETE",contentType:"application/json",data:JSON.stringify('{"ok": true}'),async:!1,success:function(a){location.href=MAINFRONT;console.log(a)}})};
